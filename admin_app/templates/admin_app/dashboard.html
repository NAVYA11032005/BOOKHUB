{% extends 'admin_app/base.html' %}
{% block content %}
 
    <!-- BOOTSTRAP 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FONT AWESOME 6 CDN - FIXES ICONS! -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- BOOTSTRAP JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<h2>ğŸ” Admin Dashboard</h2>

<!-- STATISTICS CARDS -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <h5>Total Teachers</h5>
                <h2>{{ teacher_data|length }}</h2>  <!-- âœ… FIXED -->
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h5>Active Teachers</h5>
                <h2>{{ active_teachers }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <h5>Pending Students</h5>
                <h2>{{ pending_count }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body">
                <h5>Pending Teachers</h5>
                <h2>{{ pending_teachers|length }}</h2>
            </div>
        </div>
    </div>
</div>

<!-- PENDING TEACHER REGISTRATIONS -->
<h4>ğŸ”„ Pending Teacher Registrations ({{ pending_teachers|length }})</h4>
{% if pending_teachers %}
<div class="table-responsive mb-4">
    <table class="table table-striped table-warning">
        <thead class="table-dark">
            <tr><th>Name</th><th>Email</th><th>Department</th><th>Subject</th><th>Registered</th><th>Action</th></tr>
        </thead>
        <tbody>
            {% for treq in pending_teachers %}
            <tr>
                <td><strong>{{ treq.name }}</strong></td>
                <td>{{ treq.email }}</td>
                <td>{{ treq.department }}</td>
                <td>{{ treq.subject }}</td>
                <td>{{ treq.created_at|date:"M d, Y" }}</td>
                <td>
                    <a href="{% url 'approve_teacher_request' treq.pk %}" 
                       class="btn btn-sm btn-success" 
                       onclick="return confirm('Approve {{ treq.name }}?')">
                        <i class="fas fa-check"></i> Approve
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-success">âœ… No pending teacher registrations.</div>
{% endif %}

<!-- REGISTERED TEACHERS -->
<h4>ğŸ‘¨â€ğŸ« Registered Teachers ({{ teacher_data|length }})</h4>  <!-- âœ… FIXED -->
<a href="{% url 'add_teacher' %}" class="btn btn-success mb-3">
    <i class="fas fa-plus"></i> Add Teacher
</a>
<div class="table-responsive mb-5">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Name</th><th>Department</th><th>Subject</th><th>Email</th>
                <th>Login</th><th>Status</th><th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in teacher_data %}  <!-- âœ… FIXED: teacher_data -->
            <tr class="{% if item.has_profile %}table-success{% else %}table-secondary{% endif %}">
                <td><strong>{{ item.teacher.name }}</strong></td>
                <td>{{ item.teacher.department }}</td>
                <td><span class="badge bg-primary">{{ item.teacher.subject }}</span></td>
                <td>{{ item.teacher.email }}</td>
                <td>
                    {% if item.has_profile %}
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle"></i> Active
                        </span>
                        <br><small>ğŸ‘¤ {{ item.username }}</small>
                    {% else %}
                        <span class="badge bg-warning text-dark">No Login</span>
                    {% endif %}
                </td>
                <td>
                    {% if item.has_profile %}
                        <span class="badge bg-success">âœ… Can Login</span>
                    {% else %}
                        <span class="badge bg-danger">âŒ Setup Needed</span>
                    {% endif %}
                </td>
               <td>
    <div class="btn-group btn-group-sm" role="group">
        <a href="{% url 'update_teacher' item.teacher.pk %}" 
           class="btn btn-warning px-2 py-1" title="Edit">
            <i class="fas fa-edit me-1"></i>Edit
        </a>
        <a href="{% url 'reset_teacher_password' item.teacher.pk %}" 
           class="btn btn-info px-2 py-1" title="Reset Password">
            <i class="fas fa-key me-1"></i>Reset
        </a>
        <a href="{% url 'delete_teacher' item.teacher.pk %}" 
           class="btn btn-danger px-2 py-1" title="Delete"
           onclick="return confirm('Delete {{ item.teacher.name }}?')">
            <i class="fas fa-trash me-1"></i>Delete
        </a>
    </div>
</td>


            </tr>
            {% empty %}
            <tr><td colspan="7" class="text-center py-4">No registered teachers yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- PENDING STUDENTS -->
<h4>ğŸ“ Pending Student Approvals ({{ pending_count }})</h4>
{% if pending_students %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr><th>Name</th><th>Email</th><th>Phone</th><th>Registered</th><th>Action</th></tr>
        </thead>
        <tbody>
            {% for student in pending_students %}
            <tr class="table-warning">
                <td><strong>{{ student.name }}</strong></td>
                <td>{{ student.email }}</td>
                <td>{{ student.phone|default:"N/A" }}</td>
                <td>{{ student.created_at|date:"M d, Y H:i" }}</td>
                <td>
                    <a href="{% url 'approve_student' student.pk %}" 
                       class="btn btn-sm btn-success" 
                       onclick="return confirm('Approve {{ student.name }}?')">
                        <i class="fas fa-check"></i> Approve
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> No pending student registrations.
</div>
{% endif %}

<style>
.table-hover tbody tr:hover { background-color: rgba(0,123,255,.075); }
.btn-group .btn { margin-right: 2px; }
.table-success { border-left: 4px solid #28a745; }
.table-secondary { border-left: 4px solid #6c757d; }
.card { transition: transform 0.2s; }
.card:hover { transform: translateY(-2px); }
</style>
{% endblock %}
